# JSONデータベース TUI スケジュール管理ソフト — 作業仕様書

## 1. プロジェクト概要

JSON ファイルをデータベースとして使用する TUI（Terminal User Interface）ベースのスケジュール管理アプリケーション。
メイン画面に月カレンダーを配置し、日付選択でスケジュール詳細を表示する。

---

## 2. 技術スタック

| 項目 | 技術 |
|---|---|
| 言語 | Python |
| TUI フレームワーク | textual |
| データストア | JSON ファイル |
| バックアップ | 書き込み時に `.bak` 自動生成 |

---

## 3. データ構造

### 3.1 スケジュールレコード

```json
{
  "id": "uuid",
  "date_time": "2506_1430",
  "date_time_type": "exact | until | from",
  "title": "会議タイトル",
  "memo": "メモ内容",
  "created_at": "2506_1200"
}
```

### 3.2 日時フォーマット

- **基本表記**: `YYMM_HHSS`（例: `2506_1430` → 2025年6月 14:30）
  - `YY` — 年（下2桁）
  - `MM` — 月（2桁）
  - `HH` — 時（24時間表記）
  - `SS` — 分（2桁）
- **指定時間まで**: `~YYMM_HHSS`（例: `~2506_1430` → 2025年6月 14:30 まで）
- **指定時間以降**: `YYMM_HHSS~`（例: `2506_1430~` → 2025年6月 14:30 以降）

### 3.3 JSON ファイル構成

```
data/
├── schedules.json       # スケジュールデータ本体
├── schedules.json.bak   # 自動バックアップ
└── config.json          # アプリ設定（表示月初期値等）
```

`schedules.json` の構造:

```json
{
  "schedules": [
    {
      "id": "a1b2c3d4",
      "date_time": "2506_1430",
      "date_time_type": "exact",
      "title": "チームミーティング",
      "memo": "議題: Q3計画",
      "created_at": "2505_0900"
    }
  ]
}
```

---

## 4. 機能一覧

### 4.1 スケジュール登録

| 入力項目 | 必須 | 説明 |
|---|---|---|
| 日付・時間 | ○ | `YYMM_HHSS` / `~YYMM_HHSS` / `YYMM_HHSS~` |
| タイトル | ○ | スケジュール名称 |
| メモ | — | 自由記述 |

- 登録時に `created_at` を自動付与
- `id` は UUID 自動生成

### 4.2 スケジュール確認

- カレンダー上の日付を選択 → 該当日のスケジュール一覧を詳細ビューに表示
- 詳細ビューに表示する項目:
  - 日付・時間（タイプ表記含む）
  - タイトル
  - メモ
  - 作成日時

### 4.3 スケジュール編集・削除

- 詳細ビューからレコードを選択して編集・削除

---

## 5. 表示 UI 設計

### 5.1 全体レイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│  [ヘッダー]  JSONスケジュール管理  ◀ 2025年06月 ▶              │
├──────────────────────────────┬──────────────────────────────────┤
│                              │                                  │
│   月カレンダー View          │   スケジュール詳細 View          │
│                              │                                  │
│   Mon Tue Wed Thu Fri Sat Sun│   ── 2025/06/14 ──              │
│                         1    │                                  │
│    2   3   4   5   6   7   8 │   14:30  チームミーティング      │
│    9  10  11  12  13 [14] 15 │   memo: 議題: Q3計画            │
│   16  17  18  19  20  21  22 │   作成: 2506_0900               │
│   23  24  25  26  27  28  29 │                                  │
│   30                         │   15:00~ 外出                   │
│                              │   memo: 渋谷方面                │
│   ● = スケジュールあり       │   作成: 2506_0830               │
│                              │                                  │
├──────────────────────────────┴──────────────────────────────────┤
│  [フッター]  a:追加  e:編集  d:削除  /:検索  q:終了            │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 月カレンダー View

- 当月のカレンダーをグリッド表示
- スケジュールが存在する日付にはマーカー（`●` など）を表示
- 矢印キー / マウスで日付を選択
- `◀` `▶` で月を切り替え
- 選択中の日付はハイライト表示
- 日付を選択すると右側の詳細ビューが連動して更新される

### 5.3 スケジュール詳細 View

- 選択された日付のスケジュールを時間順にリスト表示
- 各スケジュールの表示内容:
  - **日付・時間**: タイプに応じた表記（`14:30` / `~14:30` / `14:30~`）
  - **タイトル**
  - **メモ**
  - **作成日時**
- スケジュールが無い場合は「スケジュールなし」を表示
- リスト内でカーソル移動可能（編集・削除対象の選択用）

---

## 6. キーバインド

| キー | 操作 |
|---|---|
| `←` `→` `↑` `↓` | カレンダー日付移動 |
| `Enter` | 詳細ビューにフォーカス移動 |
| `a` | スケジュール追加 |
| `e` | 選択中スケジュール編集 |
| `d` | 選択中スケジュール削除（確認ダイアログ付き） |
| `/` | 検索 |
| `<` / `>` | 前月 / 翌月 |
| `t` | 今日に移動 |
| `Tab` | カレンダー ↔ 詳細ビュー フォーカス切替 |
| `q` | 終了 |

---

## 7. ファイル構成

```
jsondb-tui/
├── main.py                  # エントリポイント
├── app.py                   # Textual App クラス
├── db/
│   ├── __init__.py
│   ├── store.py             # JSON 読み書き・ロック・バックアップ
│   ├── query.py             # 検索・フィルタ・ソートエンジン
│   └── schema.py            # バリデーション
├── models/
│   ├── __init__.py
│   └── schedule.py          # Schedule データモデル（dataclass）
├── ui/
│   ├── __init__.py
│   ├── calendar_view.py     # 月カレンダー Widget
│   ├── detail_view.py       # スケジュール詳細 Widget
│   ├── schedule_form.py     # 追加・編集フォーム（モーダル）
│   └── header_footer.py     # ヘッダー・フッター
├── utils/
│   ├── __init__.py
│   ├── datetime_util.py     # YYMM_HHSS パーサー・フォーマッター
│   └── backup.py            # バックアップ管理
├── data/
│   └── schedules.json       # スケジュールデータ
├── requirements.txt         # textual 等
└── README.md
```

---

## 8. 実装優先順位

| フェーズ | 内容 |
|---|---|
| Phase 1 | データモデル・JSON Store・YYMM_HHSS パーサー |
| Phase 2 | カレンダー View ＋ 詳細 View（表示のみ） |
| Phase 3 | CRUD 操作（追加・編集・削除フォーム） |
| Phase 4 | 検索・月切替・キーバインド整備 |
| Phase 5 | バックアップ・エラーハンドリング・UI 仕上げ |

---

## 9. 備考

- 日時フォーマット `YYMM_HHSS` は日（DD）を含まないため、日付はカレンダー選択で確定する設計とする。もしくはフォーマットを `YYMM**DD**_HHSS` に拡張する必要がある → **要確認事項**
- textual のバージョンは最新安定版を使用
- Python 3.10 以上を前提
