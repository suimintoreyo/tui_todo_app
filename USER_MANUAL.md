# JSON スケジュール管理 TUI — ユーザマニュアル

## 目次

1. [はじめに](#はじめに)
2. [動作環境・インストール](#動作環境インストール)
3. [起動方法](#起動方法)
4. [画面構成](#画面構成)
5. [基本操作](#基本操作)
6. [スケジュールの追加](#スケジュールの追加)
7. [スケジュールの編集](#スケジュールの編集)
8. [スケジュールの削除](#スケジュールの削除)
9. [検索](#検索)
10. [日時フォーマット](#日時フォーマット)
11. [データファイル](#データファイル)
12. [キーバインド一覧](#キーバインド一覧)
13. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

JSON スケジュール管理 TUI は、ターミナル上で動作するスケジュール管理アプリケーションです。
月カレンダーとスケジュール詳細の2ペイン構成で、キーボード操作によりスケジュールの追加・編集・削除・検索を行えます。

データは JSON ファイルに保存され、書き込み時に自動バックアップ（`.bak`）が作成されます。

---

## 動作環境・インストール

### 動作環境

- Python 3.10 以上
- ターミナルエミュレータ（UTF-8 対応）

### インストール

```bash
pip install -r requirements.txt
```

必要なパッケージ:

| パッケージ | 用途 |
|-----------|------|
| textual   | TUI フレームワーク |

---

## 起動方法

```bash
python3 main.py
```

起動すると、当月のカレンダーが表示され、今日の日付が選択された状態になります。

---

## 画面構成

```
┌─────────────────────────────────────────────────────────────────┐
│                    JSON スケジュール管理                        │  ← ヘッダー
├──────────────────────────────┬──────────────────────────────────┤
│                              │                                  │
│     ◀  2026年02月  ▶        │  ── 2026/02/19 ──               │
│                              │                                  │
│  Mon Tue Wed Thu Fri Sat Sun │    10:00  チームミーティング     │
│                          1   │           memo: Q1計画策定       │
│    2   3   4   5   6   7  8  │                                  │
│    9  10  11  12  13  14  15 │    14:30  コードレビュー         │
│   16  17  18 [19] 20  21  22 │           memo: PR #123          │
│   23  24  25  26  27  28     │                                  │
│                              │    18:00~ 外出                   │
│   ● = スケジュールあり       │           memo: 渋谷方面         │
│                              │                                  │
│  左ペイン: カレンダー        │  右ペイン: スケジュール詳細      │
├──────────────────────────────┴──────────────────────────────────┤
│ a:追加  e:編集  d:削除  /:検索  t:今日  </>:月切替  Tab:切替   │  ← フッター
│                                                        q:終了  │
└─────────────────────────────────────────────────────────────────┘
```

### 左ペイン（カレンダー）

- 月ナビゲーションボタン（◀ ▶）で前月・翌月に移動できます
- スケジュールが存在する日には `●` マークが表示されます
- 今日の日付はハイライト表示されます
- 選択中の日付は背景色で強調されます
- 日付をクリック、またはカーソルで選択すると右ペインに詳細が表示されます

### 右ペイン（スケジュール詳細）

- 選択された日付のスケジュールが時刻順に一覧表示されます
- 各スケジュールには時刻、タイトル、メモが表示されます
- スケジュールがない日は「スケジュールなし」と表示されます

---

## 基本操作

### カレンダーの日付を選択する

カレンダー上の日付をクリックすると、その日のスケジュールが右ペインに表示されます。

### フォーカスの切り替え

`Tab` キーでカレンダーとスケジュール一覧のフォーカスを切り替えます。

- カレンダーにフォーカス → 日付の選択操作
- スケジュール一覧にフォーカス → スケジュールの選択（編集・削除対象の指定）

### 月の移動

| 操作 | 説明 |
|------|------|
| `<` キー | 前月へ移動 |
| `>` キー | 翌月へ移動 |
| `t` キー | 今日の日付へジャンプ |
| ◀ ボタン | 前月へ移動（クリック） |
| ▶ ボタン | 翌月へ移動（クリック） |

---

## スケジュールの追加

1. カレンダーで追加したい日付を選択します
2. `a` キーを押すと、追加フォームが表示されます
3. 各項目を入力します:

| 項目 | 入力形式 | 必須 | 説明 |
|------|---------|------|------|
| 日付 | `YYMMDD` | はい | 年2桁 + 月2桁 + 日2桁（例: `260219`） |
| 時刻 | `HHMM`   | はい | 時2桁 + 分2桁、24時間制（例: `1430`） |
| タイプ | 選択式  | はい | 「指定時刻」「～まで」「～以降」のいずれか |
| タイトル | テキスト | はい | スケジュール名 |
| メモ | テキスト | いいえ | 補足情報（任意） |

4. 「保存」ボタンで保存、「キャンセル」ボタンで中止します

**入力例:**

| 項目 | 入力 | 意味 |
|------|------|------|
| 日付 | `260219` | 2026年2月19日 |
| 時刻 | `1430` | 14:30 |
| タイプ | 指定時刻 | その時刻のスケジュール |
| タイトル | チームミーティング | — |
| メモ | Q1計画策定 | — |

---

## スケジュールの編集

1. カレンダーで編集したいスケジュールの日付を選択します
2. `Tab` キーでスケジュール一覧にフォーカスを移します
3. 上下キーで編集したいスケジュールを選択します
4. `e` キーを押すと、編集フォームが表示されます（現在の値が入力済み）
5. 必要な項目を変更し、「保存」ボタンで保存します

> 日付を変更すると、保存後に変更先の日付に自動で移動します。

---

## スケジュールの削除

1. カレンダーで削除したいスケジュールの日付を選択します
2. `Tab` キーでスケジュール一覧にフォーカスを移します
3. 上下キーで削除したいスケジュールを選択します
4. `d` キーを押すと、確認ダイアログが表示されます
5. 「はい」で削除、「いいえ」でキャンセルします

---

## 検索

1. `/` キーを押すと、検索ダイアログが表示されます
2. 検索キーワードを入力し、「検索」ボタンまたは `Enter` キーで実行します
3. タイトルまたはメモにキーワードを含むスケジュールが検索されます
4. 結果が見つかった場合、最初のスケジュールの日付に自動で移動します
5. 結果件数が通知されます

> 検索は大文字・小文字を区別しません。

---

## 日時フォーマット

### 基本形式: `YYMMDD_HHMM`

| 部位 | 桁数 | 説明 | 例 |
|------|------|------|----|
| YY   | 2桁  | 西暦の下2桁 | `26` = 2026年 |
| MM   | 2桁  | 月 | `02` = 2月 |
| DD   | 2桁  | 日 | `19` = 19日 |
| HHMM | 4桁  | 時刻（24時間制） | `1430` = 14:30 |

### タイプ修飾子

| タイプ | 表記 | 表示例 | 意味 |
|--------|------|--------|------|
| 指定時刻 (exact) | `260219_1430` | `14:30` | その時刻のスケジュール |
| ～まで (until) | `~260219_1430` | `~14:30` | その時刻までに完了すべきもの |
| ～以降 (from) | `260219_1430~` | `14:30~` | その時刻以降のスケジュール |

---

## データファイル

### ファイル構成

```
data/
├── schedules.json       # スケジュールデータ（メイン）
├── schedules.json.bak   # 自動バックアップ（前回保存時の内容）
└── config.json          # アプリ設定
```

### schedules.json の構造

```json
{
  "schedules": [
    {
      "id": "a1b2c3d4",
      "date_time": "260219_1430",
      "date_time_type": "exact",
      "title": "チームミーティング",
      "memo": "Q1計画策定",
      "created_at": "260218_0900"
    }
  ]
}
```

| フィールド | 型 | 説明 |
|-----------|------|------|
| `id` | string | 一意な識別子（自動生成） |
| `date_time` | string | 日時（`YYMMDD_HHMM` 形式、タイプ修飾子付き） |
| `date_time_type` | string | `exact` / `until` / `from` |
| `title` | string | スケジュール名 |
| `memo` | string | メモ（空文字列可） |
| `created_at` | string | 作成日時（`YYMMDD_HHMM` 形式、自動記録） |

### 自動バックアップ

スケジュールの追加・編集・削除でデータを保存するたびに、直前の `schedules.json` が `schedules.json.bak` として自動保存されます。

データが破損した場合は、`.bak` ファイルをリネームして復元できます:

```bash
cp data/schedules.json.bak data/schedules.json
```

---

## キーバインド一覧

| キー | 操作 | コンテキスト |
|------|------|-------------|
| `a` | スケジュール追加 | 全画面 |
| `e` | スケジュール編集 | スケジュール選択時 |
| `d` | スケジュール削除 | スケジュール選択時 |
| `/` | 検索 | 全画面 |
| `t` | 今日の日付へ移動 | 全画面 |
| `<` | 前月へ移動 | 全画面 |
| `>` | 翌月へ移動 | 全画面 |
| `Tab` | カレンダー ↔ 一覧のフォーカス切替 | 全画面 |
| `q` | アプリ終了 | 全画面 |
| `Enter` | 日付選択の確定 | カレンダー |
| `↑` `↓` | スケジュールの選択移動 | スケジュール一覧 |

---

## トラブルシューティング

### アプリが起動しない

```
ModuleNotFoundError: No module named 'textual'
```

→ `pip install -r requirements.txt` で依存パッケージをインストールしてください。

### 文字化けする

→ ターミナルの文字エンコーディングが UTF-8 に設定されているか確認してください。

### データが消えた

→ `data/schedules.json.bak` に前回保存時のバックアップがあります。以下で復元できます:

```bash
cp data/schedules.json.bak data/schedules.json
```

### `data/` ディレクトリがない

→ アプリ初回起動時に自動作成されます。手動で作成する場合:

```bash
mkdir -p data
```
